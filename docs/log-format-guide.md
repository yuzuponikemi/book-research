# ログファイル（Thinking Log）の解説

Cogitoパイプラインの実行ログは `logs/` ディレクトリにJSON形式で保存されます（例: `logs/run_YYYYMMDD_HHMMSS.json`）。
このファイルには、システムが行った**全てのLLM呼び出し（思考プロセス）**が記録されており、デバッグやプロンプトエンジニアリングの改善に不可欠な資料です。

## ファイル構造の概要

JSONファイルのルートは、ステップ（Step）の配列になっています。
配列の各要素が、パイプラインの1つの「思考ステップ」に対応します。

```json
[
  { "step": 1, ... },
  { "step": 2, ... },
  ...
]
```

## 各ステップの詳細フィールド

1つのステップオブジェクトには以下の情報が含まれています。

### 1. 識別情報
どのモジュールのどの処理かを特定します。

*   `timestamp`: 実行時刻
*   `layer`: 担当レイヤー（例: `reader`, `director`, `dramaturg`）
*   `node`: 具体的な担当モジュール（例: `analyst`, `scriptwriter`）
*   `action`: 実行されたアクション名（例: `analyze_chunk:part_1`, `write_script:episode_1`）

### 2. 入力と推論 (Input & Reasoning)
LLMに何を渡し、システムがどう判断したか。

*   `input_summary`: 人間が読みやすい入力データの要約（例: "Chunk 'part_1': 15000 chars"）
*   `reasoning`: 処理完了後のシステムの要約コメント（例: "Extracted 12 concepts from part_1"）

### 3. LLMとの対話 (The Core)
**ここが最も重要です。** LLMに実際に送られたプロンプトと、返ってきた生の回答です。

*   `llm_prompt`: **プロンプト全文**。変数が展開された後の、実際にモデルに入力されたテキストです。
    *   プロンプトの修正を行いたい場合、ここをコピーして手元で試行錯誤することができます。
*   `llm_raw_response`: **モデルからの生生成テキスト**。
    *   JSONパースエラーなどが起きた場合、モデルが実際に何を返したか（余計な挨拶文が入っていないか等）をここで確認できます。

### 4. 解析結果 (Parsed Output)
生のレスポンスからプログラムが抽出した構造化データです。

*   `parsed_output`: JSONオブジェクト。
    *   `error`: パースに失敗した場合、ここにエラーメッセージが入ります。成功時は `null` です。

---

## 具体的な活用シナリオ

### シナリオA: 「台本が日本語になっていない」等の不具合調査
1.  ログファイルを開き、`"action": "write_script:episode_..."` を検索します。
2.  `llm_prompt` を確認します。指示の中に正しく「日本語で書いて」という命令が含まれているか？ `persona_config` の値（口調など）は正しく埋め込まれているか？
3.  `llm_raw_response` を確認します。モデルが指示を無視しているのか、あるいはプロンプトが途切れているのかを確認します。

### シナリオB: 「概念抽出の精度が低い」場合の改善
1.  `"node": "analyst"` のステップを探します。
2.  `llm_raw_response` を見ます。モデルが概念の説明をどのように書いているかを確認します。
3.  もし説明が浅い場合、`src/reader/analyst.py` 内のプロンプト（`ANALYSIS_PROMPT`）を修正する際の参考にします。

### シナリオC: エラー原因の特定
1.  ファイル内で `"error":` という文字列を検索します。
2.  `null` 以外の値が入っているステップを見つけます。
3.  そのステップの `llm_raw_response` を見ることで、なぜJSONパースに失敗したか（例: JSONが途中で切れている、Markdownのコードブロック記号が含まれている）を特定できます。

## ログビューアの活用（推奨）

このJSONファイルは非常に長大（数万行）になることがあります。VS Codeなどのエディタで閲覧する際は、以下の機能を活用すると便利です。

*   **折りたたみ (Fold)**: ステップごとに折りたたんで、興味のあるステップだけを展開する。
*   **パンくずリスト**: JSONの階層構造を把握する。
